{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// 子组件\nimport HomeSwiper from './childComps/HomeSwiper';\nimport HomeRecommendView from './childComps/HomeRecommendView.vue';\nimport HomeFeatureView from './childComps/HomeFeatureView.vue'; // 公共组件\n\nimport NavBar from '../../components/common/navbar/NavBar.vue';\nimport TabControl from '../../components/content/tabControl/TabControl';\nimport GoodList from '../../components/content/goods/GoodsList';\nimport Scroll from '../../components/common/scroll/Scroll';\nimport BackTop from '../../components/content/backTop/BackTop';\nimport { getHomeMultidata, getHomeGoods } from \"../../network/home\";\nimport { debounce } from \"../../common/utils\";\nimport { itemListenerMixin } from \"../../common/mixin\";\nexport default {\n  name: \"home\",\n  components: {\n    HomeSwiper,\n    HomeRecommendView,\n    HomeFeatureView,\n    NavBar,\n    TabControl,\n    GoodList,\n    Scroll,\n    BackTop\n  },\n  mixins: [itemListenerMixin],\n\n  data() {\n    return {\n      currentType: 'pop',\n      isShowBackTop: false,\n      tabOffsetTop: 0,\n      isTabFixed: false,\n      saveY: 0,\n      // itemImgListener: null,\n      banners: [],\n      recommends: [],\n      goods: {\n        'pop': {\n          page: 0,\n          list: []\n        },\n        'new': {\n          page: 0,\n          list: []\n        },\n        'sell': {\n          page: 0,\n          list: []\n        }\n      }\n    };\n  },\n\n  computed: {\n    showGoods() {\n      return this.goods[this.currentType].list;\n    }\n\n  },\n\n  destroyed() {\n    console.log('hume destroyed');\n  },\n\n  activated() {\n    this.$refs.scroll.scrollTo(0, this.saveY, 1);\n    this.$refs.scroll.refresh();\n  },\n\n  deactivated() {\n    // 1.保存Y值\n    this.saveY = this.$refs.scroll.getScrollY(); // 2.取消全局事件的监听\n\n    this.$bus.$off('itemImgLoad', this.itemImgListener);\n  },\n\n  created() {\n    // 1.请求多个数据\n    this.getHomeMultidata(); //2.请求商品数据\n\n    this.getHomeGoods('pop');\n    this.getHomeGoods('new');\n    this.getHomeGoods('sell');\n  },\n\n  mounted() {\n    // 1.监听item中图片加载完成\n    const refresh = debounce(this.$refs.scroll.refresh, 50);\n\n    this.itemImgListener = () => {\n      refresh();\n    }; // this.$bus.$on('itemImageLoad', this.itemImgListener)\n\n  },\n\n  methods: {\n    // 事件监听相关的方法\n    tabClick(index) {\n      switch (index) {\n        case 0:\n          this.currentType = 'pop';\n          break;\n\n        case 1:\n          this.currentType = 'new';\n          break;\n\n        case 2:\n          this.currentType = 'sell';\n          break;\n      }\n    },\n\n    backClick() {\n      this.$refs.scroll.scrollTo(0, 0, 1000);\n    },\n\n    contentScroll(position) {\n      // 1.判断BackTop是否显示\n      this.isShowBackTop = -position.y > 1200; // 2.决定tabControl是否吸顶（position: fixed）\n\n      this.isTabFixed = -position.y > this.tabOffsetTop;\n    },\n\n    loadMore() {\n      this.getHomeGoods(this.currentType);\n    },\n\n    swiperImageLoad() {\n      // 获取tabControl的offsetTop\n      // 所有的组件都有一个属性$el：用于获取组件中的元素\n      this.tabOffsetTop = this.$refs.tabControl.$el.offsetTop; // console.log(this.tabOffsetTop);\n    },\n\n    // 网络请求相关的方法\n    getHomeMultidata() {\n      getHomeMultidata().then(res => {\n        // console.log(res);\n        this.banners = res.data.banner.list;\n        this.recommends = res.data.recommend.list;\n      });\n    },\n\n    getHomeGoods(type) {\n      const page = this.goods[type].page + 1;\n      getHomeGoods(type, page).then(res => {\n        // console.log(res);\n        this.goods[type].list.push(...res.data.list);\n        this.goods[type].page += 1; // 完成上拉加载更多\n\n        this.$refs.scroll.finishPullUp();\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;AACA,+D,CAEA;;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAGA;EACAA,YADA;EAEAC;IACAC,UADA;IAEAC,iBAFA;IAGAC,eAHA;IAIAC,MAJA;IAKAC,UALA;IAMAC,QANA;IAOAC,MAPA;IAQAC;EARA,CAFA;EAYAC,2BAZA;;EAaAC;IACA;MACAC,kBADA;MAEAC,oBAFA;MAGAC,eAHA;MAIAC,iBAJA;MAKAC,QALA;MAMA;MACAC,WAPA;MAQAC,cARA;MASAC;QACA;UAAAC;UAAAC;QAAA,CADA;QAEA;UAAAD;UAAAC;QAAA,CAFA;QAGA;UAAAD;UAAAC;QAAA;MAHA;IATA;EAeA,CA7BA;;EA8BAC;IACAC;MACA;IACA;;EAHA,CA9BA;;EAmCAC;IACAC;EACA,CArCA;;EAsCAC;IACA;IACA;EACA,CAzCA;;EA0CAC;IACA;IACA,4CAFA,CAIA;;IACA;EACA,CAhDA;;EAiDAC;IACA;IACA,wBAFA,CAGA;;IACA;IACA;IACA;EACA,CAxDA;;EAyDAC;IACA;IACA;;IAEA;MACAC;IACA,CAFA,CAJA,CAOA;;EACA,CAjEA;;EAkEAC;IACA;IAEAC;MACA;QACA;UACA;UACA;;QACA;UACA;UACA;;QACA;UACA;UACA;MATA;IAWA,CAfA;;IAgBAC;MACA;IACA,CAlBA;;IAmBAC;MACA;MACA,wCAFA,CAIA;;MACA;IACA,CAzBA;;IA0BAC;MACA;IACA,CA5BA;;IA6BAC;MACA;MACA;MACA,wDAHA,CAIA;IACA,CAlCA;;IAqCA;IACAC;MACAA;QACA;QACA;QACA;MACA,CAJA;IAKA,CA5CA;;IA6CAC;MACA;MACAA;QACA;QACA;QACA,2BAHA,CAKA;;QACA;MACA,CAPA;IAQA;;EAvDA;AAlEA","names":["name","components","HomeSwiper","HomeRecommendView","HomeFeatureView","NavBar","TabControl","GoodList","Scroll","BackTop","mixins","data","currentType","isShowBackTop","tabOffsetTop","isTabFixed","saveY","banners","recommends","goods","page","list","computed","showGoods","destroyed","console","activated","deactivated","created","mounted","refresh","methods","tabClick","backClick","contentScroll","loadMore","swiperImageLoad","getHomeMultidata","getHomeGoods"],"sourceRoot":"src/views/home","sources":["home.vue"],"sourcesContent":["<template>\r\n    <div id=\"home\">\r\n        <nav-bar class=\"home-nav\"><div slot=\"center\">购物街</div></nav-bar>\r\n        <tab-control :titles=\"['流行','新款','精选']\" \r\n        @tabClick=\"tabClick\" \r\n        ref=\"tabControl\"\r\n        class=\"tab-control\" v-show=\"isTabFixed\"></tab-control>\r\n\r\n        <scroll\r\n         class=\"content\"\r\n         ref=\"scroll\"\r\n         :probe-type=\"3\"\r\n         @scroll=\"contentScroll\"\r\n         :pull-up-load=\"true\"\r\n         @pullingUp=\"loadMore\"\r\n         >\r\n        <home-swiper :banners=\"banners\" @swiperImageLoad=\"swiperImageLoad\"/>\r\n        <home-recommend-view :recommends=\"recommends\"/>\r\n        <home-feature-view/>\r\n        <tab-control :titles=\"['流行','新款','精选']\" \r\n        @tabClick=\"tabClick\" \r\n        ref=\"tabControl\"></tab-control>\r\n        <good-list :goods=\"showGoods\"/>\r\n        </scroll>\r\n\r\n        <back-top @click.native=\"backClick\" v-show=\"isShowBackTop\"/>\r\n\r\n\r\n    </div>\r\n</template>\r\n<script>\r\n// 子组件\r\nimport HomeSwiper from './childComps/HomeSwiper';\r\nimport HomeRecommendView from './childComps/HomeRecommendView.vue'\r\nimport HomeFeatureView from './childComps/HomeFeatureView.vue'\r\n\r\n// 公共组件\r\nimport NavBar from '../../components/common/navbar/NavBar.vue';\r\nimport TabControl from '../../components/content/tabControl/TabControl'\r\nimport GoodList from '../../components/content/goods/GoodsList'\r\nimport Scroll from '../../components/common/scroll/Scroll'\r\nimport BackTop from '../../components/content/backTop/BackTop'\r\n\r\n\r\nimport {getHomeMultidata, getHomeGoods} from \"../../network/home\";\r\nimport {debounce} from \"../../common/utils\"\r\nimport {itemListenerMixin} from \"../../common/mixin\"\r\n\r\n\r\nexport default {\r\n    name: \"home\",\r\n    components: {\r\n        HomeSwiper,\r\n        HomeRecommendView,\r\n        HomeFeatureView,\r\n        NavBar,\r\n        TabControl,\r\n        GoodList,\r\n        Scroll,\r\n        BackTop,\r\n    },\r\n    mixins: [itemListenerMixin],\r\n    data() {\r\n        return {\r\n            currentType: 'pop',\r\n            isShowBackTop: false,\r\n            tabOffsetTop: 0,\r\n            isTabFixed: false,\r\n            saveY: 0,\r\n            // itemImgListener: null,\r\n            banners: [],\r\n            recommends: [],\r\n            goods: {\r\n                'pop': {page: 0, list:[]},\r\n                'new': {page: 0, list:[]},\r\n                'sell': {page: 0, list:[]},\r\n            }\r\n        }\r\n    },\r\n    computed: {\r\n        showGoods() {\r\n            return this.goods[this.currentType].list\r\n        }\r\n    },\r\n    destroyed() {\r\n        console.log('hume destroyed');\r\n    },\r\n    activated() {\r\n        this.$refs.scroll.scrollTo(0, this.saveY,1)\r\n        this.$refs.scroll.refresh()\r\n    },\r\n    deactivated() {\r\n        // 1.保存Y值\r\n        this.saveY = this.$refs.scroll.getScrollY()\r\n\r\n        // 2.取消全局事件的监听\r\n        this.$bus.$off('itemImgLoad', this.itemImgListener)\r\n    },\r\n    created() {\r\n        // 1.请求多个数据\r\n        this.getHomeMultidata()\r\n        //2.请求商品数据\r\n        this.getHomeGoods('pop');\r\n        this.getHomeGoods('new');\r\n        this.getHomeGoods('sell');\r\n    },\r\n    mounted() {\r\n        // 1.监听item中图片加载完成\r\n        const refresh = debounce(this.$refs.scroll.refresh,50)\r\n\r\n        this.itemImgListener = () => {\r\n            refresh()\r\n        }\r\n        // this.$bus.$on('itemImageLoad', this.itemImgListener)\r\n    },\r\n    methods: {\r\n        // 事件监听相关的方法\r\n        \r\n        tabClick(index) {\r\n            switch(index) {\r\n                case 0:\r\n                    this.currentType = 'pop'\r\n                    break\r\n                case 1:\r\n                    this.currentType = 'new'\r\n                    break\r\n                case 2:\r\n                    this.currentType = 'sell'\r\n                    break\r\n            }\r\n        },\r\n        backClick() {\r\n            this.$refs.scroll.scrollTo(0, 0, 1000);\r\n        },\r\n        contentScroll(position) {\r\n            // 1.判断BackTop是否显示\r\n            this.isShowBackTop = (-position.y) > 1200\r\n\r\n            // 2.决定tabControl是否吸顶（position: fixed）\r\n            this.isTabFixed = (-position.y) > this.tabOffsetTop\r\n        },\r\n        loadMore() {\r\n            this.getHomeGoods(this.currentType)\r\n        },\r\n        swiperImageLoad() {\r\n            // 获取tabControl的offsetTop\r\n        // 所有的组件都有一个属性$el：用于获取组件中的元素\r\n        this.tabOffsetTop = this.$refs.tabControl.$el.offsetTop;\r\n        // console.log(this.tabOffsetTop);\r\n        },\r\n\r\n\r\n        // 网络请求相关的方法\r\n        getHomeMultidata() {\r\n            getHomeMultidata().then(res => {\r\n            // console.log(res);\r\n            this.banners = res.data.banner.list;\r\n            this.recommends = res.data.recommend.list;\r\n        })\r\n        },\r\n        getHomeGoods(type) {\r\n            const page = this.goods[type].page + 1\r\n            getHomeGoods(type, page).then(res => {\r\n                // console.log(res);\r\n                this.goods[type].list.push(...res.data.list)\r\n                this.goods[type].page += 1\r\n\r\n                // 完成上拉加载更多\r\n                this.$refs.scroll.finishPullUp()\r\n            })\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n    #home {\r\n        position: relative;\r\n        height: 100vh;\r\n        padding-top: 44px;\r\n    }\r\n    .home-nav {\r\n        position: fixed;\r\n        left: 0;\r\n        right: 0;\r\n        top: 0; \r\n         z-index: 9;\r\n        color: #fff;\r\n        background-color: var(--color-tint);\r\n    }\r\n    .tab-control {\r\n        position: relative;\r\n        background-color: #fff;\r\n    }\r\n    .content {\r\n        overflow: hidden;\r\n        position: absolute;\r\n        top: 44px;\r\n        bottom: 49px;\r\n        left: 0;\r\n        right: 0;\r\n    }\r\n\r\n\r\n    /* .content {\r\n        height: calc(100% - 93px);\r\n        overflow: hidden;\r\n        margin-top: 44px;\r\n    } */\r\n</style>"]},"metadata":{},"sourceType":"module"}