{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport DetailNavBar from './childComps/DetailNavBar.vue';\nimport DetailSwiper from './childComps/DetailSwiper.vue';\nimport DetailBaseInfo from './childComps/DetailBaseInfo.vue';\nimport DetailShopInfo from './childComps/DetailShopInfo.vue';\nimport DetailGoodsInfo from './childComps/DetailGoodsInfo.vue';\nimport DetailParamInfo from './childComps/DetailParamInfo.vue';\nimport DetailCommentInfo from './childComps/DetailCommentInfo.vue';\nimport DetailBottomBar from './childComps/DetailBottomBar.vue';\nimport Scroll from '../../components/common/scroll/Scroll.vue';\nimport GoodsList from '../../components/content/goods/GoodsList.vue'; // import Toast from '../../components/common/toast/Toast.vue'\n\nimport { getDetail, Goods, Shop, GoodsParam, getRecommend } from '../../network/detail.js';\nimport { debounce } from '../../common/utils';\nimport { itemListenerMixin } from '../../common/mixin';\nimport { mapActions } from 'vuex';\nexport default {\n  name: \"Detail\",\n  components: {\n    DetailNavBar,\n    DetailSwiper,\n    DetailBaseInfo,\n    DetailShopInfo,\n    DetailGoodsInfo,\n    DetailParamInfo,\n    DetailCommentInfo,\n    DetailBottomBar,\n    Scroll,\n    GoodsList // Toast\n\n  },\n  mixins: [itemListenerMixin],\n\n  data() {\n    return {\n      iid: null,\n      topImages: [],\n      goods: {},\n      shop: {},\n      detailInfo: {},\n      paramInfo: {},\n      commentInfo: {},\n      recommends: [],\n      themeTopYs: [],\n      getThemeTopY: null,\n      currentIndex: 0,\n      isShowBackTop: false // isShow: false,\n      // message: ''\n\n    };\n  },\n\n  created() {\n    // 1.保存传入的iid\n    this.iid = this.$route.params.iid; // console.log(this.iid);\n    // 2.根据iid请求数据\n\n    getDetail(this.iid).then(res => {\n      // 1.获取顶部的图片轮播数据\n      const data = res.result;\n      this.topImages = res.result.itemInfo.topImages; // console.log(this.topImages);\n      // 2.获取商品信息\n\n      this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services); // console.log(this.goods);\n      // 3.创建店铺信息的对象\n\n      this.shop = new Shop(data.shopInfo); // 4.保存商品的详情数据\n\n      this.detailInfo = data.detailInfo; // 5.获取参数信息\n\n      this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule); // 6.取出评论的信息\n\n      if (data.rate.cRate !== 0) {\n        this.commentInfo = data.rate.list[0];\n      }\n    }); // 3.请求推荐数据\n\n    getRecommend().then(res => {\n      // console.log(res);\n      this.recommends = res.data.list;\n    }); // 4.给getThemeTopY赋值（对给this.themeTopYs赋值的操作进行防抖）\n\n    this.getThemeTopY = debounce(() => {\n      this.themeTopYs = [];\n      this.themeTopYs.push(0);\n      this.themeTopYs.push(this.$refs.params.$el.offsetTop);\n      this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\n      this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\n      this.themeTopYs.push(Number.MAX_VALUE); // console.log(this.themeTopYs);\n    }, 100);\n  },\n\n  methods: { ...mapActions(['addCart']),\n\n    imageLoad() {\n      this.$refs.scroll.refresh();\n      this.getThemeTopY();\n    },\n\n    titleClick(index) {\n      this.$refs.scroll.scrollTo(0, -this.themeTopYs[index], 100);\n    },\n\n    contentScroll(position) {\n      // 1.获取y值\n      const positionY = -position.y; // 2.positionY和主题中值进行对比\n\n      let length = this.themeTopYs.length;\n\n      for (let i = 0; i < length; i++) {\n        // 小技巧（加一个很大的数字在比较）\n        if (this.currentIndex !== i && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i + 1]) {\n          this.currentIndex = i;\n          this.$refs.nav.currentIndex = this.currentIndex;\n        } // 普通做法\n        // if(this.currentIndex !== i && ((i < length - 1 && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i + 1]) || (i === length -1 && positionY >= this.themeTopYs[i]))) {\n        //     this.currentIndex = i\n        //     this.$refs.nav.currentIndex = this.currentIndex\n\n      }\n    },\n\n    addToCart() {\n      // 1.获取购物车需要展示信息\n      const product = {};\n      product.image = this.topImages[0];\n      product.title = this.goods.title;\n      product.desc = this.goods.desc;\n      product.price = this.goods.newPrice;\n      product.iid = this.iid;\n      product.realPrice = this.goods.realPrice; // console.log(product.realPrice);\n      // 2.将商品添加到购物车里\n      // this.$store.commit('addCart', product)\n\n      this.addCart(product).then(res => {\n        // this.show = true;\n        // this.message = res;\n        // setTimeout(() => {\n        //     this.show = false;\n        //     this.message = ''\n        // }, 1500)\n        this.$toast.show(res, 3000); // console.log(this.$toast);\n      }); // this.$store.dispatch('addCart', product).then(res => {\n      //     console.log(res);\n      // })\n    }\n\n  },\n\n  mounted() {// console.log('mounted');\n  },\n\n  destroyed() {\n    this.$bus.$off('itemImgLoad', this.itemImgListener);\n  }\n\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,qE,CACA;;AAEA;AACA;AACA;AAEA;AAEA;EACAA,cADA;EAEAC;IACAC,YADA;IAEAC,YAFA;IAGAC,cAHA;IAIAC,cAJA;IAKAC,eALA;IAMAC,eANA;IAOAC,iBAPA;IAQAC,eARA;IASAC,MATA;IAUAC,SAVA,CAWA;;EAXA,CAFA;EAeAC,2BAfA;;EAgBAC;IACA;MACAC,SADA;MAEAC,aAFA;MAGAC,SAHA;MAIAC,QAJA;MAKAC,cALA;MAMAC,aANA;MAOAC,eAPA;MAQAC,cARA;MASAC,cATA;MAUAC,kBAVA;MAWAC,eAXA;MAYAC,oBAZA,CAaA;MACA;;IAdA;EAgBA,CAjCA;;EAkCAC;IACA;IACA,kCAFA,CAGA;IAEA;;IACAC;MACA;MACA;MACA,+CAHA,CAIA;MAEA;;MACA,4EAPA,CAQA;MAEA;;MACA,oCAXA,CAaA;;MACA,kCAdA,CAgBA;;MACA,4EAjBA,CAmBA;;MACA;QACA;MACA;IACA,CAvBA,EANA,CA8BA;;IACAC;MACA;MACA;IACA,CAHA,EA/BA,CAmCA;;IACA;MACA;MACA;MACA;MACA;MACA;MACA,uCANA,CAQA;IACA,CATA,EASA,GATA;EAUA,CAhFA;;EAiFAC,WACA,0BADA;;IAEAC;MACA;MAEA;IACA,CANA;;IAQAC;MACA;IACA,CAVA;;IAWAC;MACA;MACA,8BAFA,CAIA;;MACA;;MACA;QACA;QACA;UACA;UACA;QACA,CALA,CAMA;QACA;QACA;QACA;;MACA;IACA,CA5BA;;IA6BAC;MACA;MACA;MACAC;MACAA;MACAA;MACAA;MACAA;MACAA,yCARA,CASA;MAEA;MACA;;MACA;QACA;QACA;QAEA;QACA;QACA;QACA;QAEA,4BATA,CAUA;MACA,CAXA,EAbA,CA2BA;MACA;MACA;IACA;;EA3DA,CAjFA;;EA+IAC,WACA;EAEA,CAlJA;;EAmJAC;IACA;EACA;;AArJA","names":["name","components","DetailNavBar","DetailSwiper","DetailBaseInfo","DetailShopInfo","DetailGoodsInfo","DetailParamInfo","DetailCommentInfo","DetailBottomBar","Scroll","GoodsList","mixins","data","iid","topImages","goods","shop","detailInfo","paramInfo","commentInfo","recommends","themeTopYs","getThemeTopY","currentIndex","isShowBackTop","created","getDetail","getRecommend","methods","imageLoad","titleClick","contentScroll","addToCart","product","mounted","destroyed"],"sourceRoot":"src/views/detail","sources":["Detail.vue"],"sourcesContent":["<template>\r\n    <div id=\"detail\">\r\n        <detail-nav-bar class=\"detail-nav\" @titleClick=\"titleClick\" ref=\"nav\"></detail-nav-bar>\r\n        <scroll class=\"content\" ref=\"scroll\" :probeType=\"3\" @scroll=\"contentScroll\">\r\n            <detail-swiper :top-images=\"topImages\"></detail-swiper>\r\n            <detail-base-info :goods=\"goods\"></detail-base-info>\r\n            <detail-shop-info :shop=\"shop\"></detail-shop-info>\r\n            <detail-goods-info :detail-info=\"detailInfo\" @imageLoad =\"imageLoad\"></detail-goods-info>\r\n            <detail-param-info :param-info=\"paramInfo\" ref=\"params\"></detail-param-info>\r\n            <detail-comment-info :comment-info=\"commentInfo\" ref=\"comment\"></detail-comment-info>\r\n            <goods-list :goods=\"recommends\" ref=\"recommend\"></goods-list>\r\n\r\n            <!-- <div>{{$store.state.cartList.length}}</div> -->\r\n            <ul>\r\n                <li v-for=\"item in $store.state.cartList\" :key=\"item.id\">{{item}}</li>\r\n            </ul>\r\n        </scroll>\r\n        <detail-bottom-bar @addCart=\"addToCart\"></detail-bottom-bar>\r\n\r\n        <!-- <toast :message=\"message\" :show=\"isShow\"></toast> -->\r\n\r\n\r\n        <!-- <div v-for=\"item in 10\" :key=\"item\">{{item}}</div> -->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailNavBar from './childComps/DetailNavBar.vue'\r\nimport DetailSwiper from './childComps/DetailSwiper.vue'\r\nimport DetailBaseInfo from './childComps/DetailBaseInfo.vue'\r\nimport DetailShopInfo from './childComps/DetailShopInfo.vue'\r\nimport DetailGoodsInfo from './childComps/DetailGoodsInfo.vue'\r\nimport DetailParamInfo from './childComps/DetailParamInfo.vue'\r\nimport DetailCommentInfo from './childComps/DetailCommentInfo.vue'\r\nimport DetailBottomBar from './childComps/DetailBottomBar.vue'\r\n\r\nimport Scroll from '../../components/common/scroll/Scroll.vue'\r\nimport GoodsList from '../../components/content/goods/GoodsList.vue'\r\n// import Toast from '../../components/common/toast/Toast.vue'\r\n\r\nimport {getDetail, Goods, Shop, GoodsParam, getRecommend} from '../../network/detail.js'\r\nimport {debounce} from '../../common/utils'\r\nimport {itemListenerMixin} from '../../common/mixin'\r\n\r\nimport { mapActions } from 'vuex'\r\n\r\nexport default {\r\n    name: \"Detail\",\r\n    components: {\r\n        DetailNavBar,\r\n        DetailSwiper,\r\n        DetailBaseInfo,\r\n        DetailShopInfo,\r\n        DetailGoodsInfo,\r\n        DetailParamInfo,\r\n        DetailCommentInfo,\r\n        DetailBottomBar,\r\n        Scroll,\r\n        GoodsList,\r\n        // Toast\r\n    },\r\n    mixins: [itemListenerMixin],\r\n    data() {\r\n        return {\r\n            iid: null,\r\n            topImages: [],\r\n            goods: {},\r\n            shop: {},\r\n            detailInfo: {},\r\n            paramInfo: {},\r\n            commentInfo: {},\r\n            recommends: [],\r\n            themeTopYs: [],\r\n            getThemeTopY: null,\r\n            currentIndex: 0,\r\n            isShowBackTop: false,\r\n            // isShow: false,\r\n            // message: ''\r\n        }\r\n    },\r\n    created() {\r\n        // 1.保存传入的iid\r\n        this.iid = this.$route.params.iid\r\n        // console.log(this.iid);\r\n\r\n        // 2.根据iid请求数据\r\n        getDetail(this.iid).then(res => {\r\n            // 1.获取顶部的图片轮播数据\r\n            const data = res.result;\r\n            this.topImages = res.result.itemInfo.topImages\r\n            // console.log(this.topImages);\r\n\r\n            // 2.获取商品信息\r\n            this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services)\r\n            // console.log(this.goods);\r\n\r\n            // 3.创建店铺信息的对象\r\n            this.shop = new Shop(data.shopInfo)\r\n\r\n            // 4.保存商品的详情数据\r\n            this.detailInfo = data.detailInfo;\r\n\r\n            // 5.获取参数信息\r\n            this.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule)\r\n\r\n            // 6.取出评论的信息\r\n            if (data.rate.cRate !== 0) {\r\n                this.commentInfo = data.rate.list[0]\r\n            }\r\n        })\r\n        // 3.请求推荐数据\r\n        getRecommend().then(res => {\r\n            // console.log(res);\r\n            this.recommends = res.data.list\r\n        })\r\n        // 4.给getThemeTopY赋值（对给this.themeTopYs赋值的操作进行防抖）\r\n        this.getThemeTopY = debounce(() => {\r\n            this.themeTopYs = [];\r\n            this.themeTopYs.push(0);\r\n            this.themeTopYs.push(this.$refs.params.$el.offsetTop);\r\n            this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\r\n            this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\r\n            this.themeTopYs.push(Number.MAX_VALUE)\r\n\r\n            // console.log(this.themeTopYs);\r\n        },100)\r\n    },\r\n    methods: {\r\n        ...mapActions(['addCart']),\r\n        imageLoad() {\r\n            this.$refs.scroll.refresh()\r\n\r\n            this.getThemeTopY()\r\n        },\r\n\r\n        titleClick(index) {\r\n            this.$refs.scroll.scrollTo(0, -this.themeTopYs[index], 100)\r\n        },\r\n        contentScroll(position) {\r\n            // 1.获取y值\r\n            const positionY = -position.y\r\n\r\n            // 2.positionY和主题中值进行对比\r\n            let length = this.themeTopYs.length\r\n            for(let i = 0; i < length; i++) {\r\n                // 小技巧（加一个很大的数字在比较）\r\n                if(this.currentIndex !== i && (positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i + 1])) {\r\n                    this.currentIndex = i;\r\n                    this.$refs.nav.currentIndex = this.currentIndex\r\n                }\r\n                // 普通做法\r\n                // if(this.currentIndex !== i && ((i < length - 1 && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i + 1]) || (i === length -1 && positionY >= this.themeTopYs[i]))) {\r\n                //     this.currentIndex = i\r\n                //     this.$refs.nav.currentIndex = this.currentIndex\r\n                }\r\n        },\r\n        addToCart() {\r\n            // 1.获取购物车需要展示信息\r\n            const product = {}\r\n            product.image = this.topImages[0]\r\n            product.title = this.goods.title;\r\n            product.desc = this.goods.desc;\r\n            product.price = this.goods.newPrice;\r\n            product.iid = this.iid;\r\n            product.realPrice = this.goods.realPrice\r\n            // console.log(product.realPrice);\r\n\r\n            // 2.将商品添加到购物车里\r\n            // this.$store.commit('addCart', product)\r\n            this.addCart(product).then(res => {\r\n                // this.show = true;\r\n                // this.message = res;\r\n\r\n                // setTimeout(() => {\r\n                //     this.show = false;\r\n                //     this.message = ''\r\n                // }, 1500)\r\n\r\n                this.$toast.show(res, 3000)\r\n                // console.log(this.$toast);\r\n            })\r\n\r\n\r\n            // this.$store.dispatch('addCart', product).then(res => {\r\n            //     console.log(res);\r\n            // })\r\n        }\r\n    },\r\n    \r\n    mounted() {\r\n        // console.log('mounted');\r\n        \r\n    },\r\n    destroyed() {\r\n        this.$bus.$off('itemImgLoad', this.itemImgListener)\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n    #detail {\r\n        position: relative;\r\n        z-index: 9;\r\n        width: 100vw;\r\n        height: 100vh;\r\n        background-color: #fff;\r\n    }\r\n    .detail-nav {\r\n        position: relative;\r\n        z-index: 9;\r\n        background-color: #fff;\r\n    }\r\n    .content {\r\n        height: calc(100% - 44px - 49px);\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}